jQuery(document).ready(function($){
    $("#login #p-captcha>*").click(function(){
        var src = $("#login #image-captcha").attr("src").split("?")[0];
        $("#login #image-captcha").attr("src", src + "?n=" + (new Date().valueOf()));
    });

    $("#login form").submit(function(){
        $("button").attr("disabled","true");
        var url = $("input[name='baseurl']").val();
        if (url.substr(-1) != "/") {
            url +=  "/";
        }
        url += "login/validate/";
        console.log(url);
        $.post(url, $(this).serialize(), function(data){
            if (data.status == 0) {
                $("#msg").attr("class","alert fade in");
                $("#msg").text(data.msg);
                $("#msg").alert();
                // localtion.href = "";
            } else {
                $("#msg").attr("class","alert alert-block alert-error fade in");
                $("#msg").text(data.msg);
                $("#msg").alert();
                //$("#msg").alert("close");
            }

        }, "json");
        $("button").removeAttr("disabled");

        return false;
    });

    // User
    $("#user form").submit(function(){
        $("button").attr("disabled","true");
        // Validate
        // Submit
        $.post($(this).attr("action"), $(this).serialize(), function(data){
            if (data.status == 0) {
                $("#msg").attr("class","alert fade in");
                $("#msg").text(data.msg);
                $("#msg").alert();
                // localtion.href = "";
            } else {
                $("#msg").attr("class","alert alert-block alert-error fade in");
                $("#msg").text(data.msg);
                $("#msg").alert();
                //$("#msg").alert("close");
            }
        }, "json");
        $("button").removeAttr("disabled");

        return false;
    });

    $("div.datepick").datetimepicker({
        format:"yyyy-mm-dd hh:ii",
        autoclose: true,
        todayBtn: true,
        pickerPosition: "bottom-left"
    });

    // Prebook
    $("#prebook input[name='chk-username']").click(function(){
        if ($(this).is(":checked")) {
            $("#prebook input[name='username']").attr("readonly", "true").addClass(" uneditable-input");
        } else {
            $("#prebook input[name='username']").removeAttr("readonly").removeClass(" uneditable-input");
        }
    });

    $("#prebook form button[name='invalid']").click(function(){
        $("#prebook form").append('<input type="hidden" name="status" value="invalid" />');
        $("#prebook form").trigger("submit");
        $("#prebook form input[name='status'][type='hidden']").remove();
        return false;
    });
    $("#prebook form").submit(function(){
        $("button").attr("disabled","true");
        // Submit
        $.post($(this).attr("action"), $(this).serialize(), function(data){
            if (data.status == 0) {
                $("#msg").attr("class","alert fade in");
                $("#msg").text(data.msg);
                $("#msg").alert();
                // localtion.href = "";
            } else {
                $("#msg").attr("class","alert alert-block alert-error fade in");
                $("#msg").text(data.msg);
                $("#msg").alert();
                //$("#msg").alert("close");
            }
        }, "json");
        $("button").removeAttr("disabled");

        return false;
    }).keydown(function(e) {
        if (e.keyCode==13) {
            e.keyCode = 9;
        }
    });

    // Test page
    $('#myTab a').click(function (e) {
          e.preventDefault();
            $(this).tab('show');
    })


    // File upload
    // ----------------------------------------------------
    // ----------------------------------------------------
});
