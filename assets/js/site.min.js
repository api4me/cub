jQuery(document).ready(function($){
    $("#login #p-captcha>*").click(function(){
        var src = $("#login #image-captcha").attr("src").split("?")[0];
        $("#login #image-captcha").attr("src", src + "?n=" + (new Date().valueOf()));
    });

    $("#login form").submit(function(){
        $("button").attr("disabled","true");
        var url = $("input[name='baseurl']").val();
        if (url.substr(-1) != "/") {
            url +=  "/";
        }
        $.post(url + "login/validate/", $(this).serialize(), function(data){
            if (data.status == 0) {
                $("#msg").attr("class","alert fade in");
                $("#msg").text(data.msg);
                $("#msg").alert();
                location.replace(data.url ? data.url : url);
            } else {
                $("#msg").attr("class","alert alert-block alert-error fade in");
                $("#msg").text(data.msg);
                $("#msg").alert();
                //$("#msg").alert("close");
            }

        }, "json");
        $("button").removeAttr("disabled");

        return false;
    });

    (function () {
        var $backToTopEle = jQuery('<div class="backtop"><a href="javascript:;"></a></div>').appendTo(jQuery("body"));

        jQuery('.backtop').click(function () {
            jQuery("html, body").animate({ scrollTop: 0 }, 200);
        });

        var _w = (jQuery(window).width() - 980) / 2 - 40;

        $backToTopFun = function () {
            var st = jQuery(document).scrollTop(),
            winh = jQuery(window).height();
            $backToTopEle.css("right", _w);
            (st > 100) ? $backToTopEle.fadeIn() : $backToTopEle.fadeOut();
            //IE6下的定位
            if (!window.XMLHttpRequest) {
                $backToTopEle.css("top", st + winh - 100);
            }
        };
        jQuery("body").append('<div class="feedback"><a href="#" title="反馈建议" target="_blank"></a></div>');
        jQuery(".feedback").css("right", _w);
        jQuery(window).bind("scroll", $backToTopFun);
        $backToTopFun();
    })();
});

