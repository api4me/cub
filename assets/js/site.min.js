jQuery(document).ready(function($){
    $("#login #p-captcha>*").click(function(){
        var src = $("#login #image-captcha").attr("src").split("?")[0];
        $("#login #image-captcha").attr("src", src + "?n=" + (new Date().valueOf()));
    });

    $("#login form").submit(function(){
        $("button").attr("disabled","true");
        var url = $("input[name='baseurl']").val();
        if (url.substr(-1) != "/") {
            url +=  "/";
        }
        $.post(url + "login/validate/", $(this).serialize(), function(data){
            if (data.status == 0) {
                $("#msg").attr("class","alert fade in");
                $("#msg").text(data.msg);
                $("#msg").alert();
                location.replace(data.url ? data.url : url);
            } else {
                $("#msg").attr("class","alert alert-block alert-error fade in");
                $("#msg").text(data.msg);
                $("#msg").alert();
                //$("#msg").alert("close");
            }

        }, "json");
        $("button").removeAttr("disabled");

        return false;
    });
});
